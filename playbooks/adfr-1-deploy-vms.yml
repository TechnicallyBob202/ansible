---
# =============================================================================
# ADFR-1: Deploy ADFR Lab VMs
# =============================================================================
# - Clone VMs from templates
# - Configure hardware (CPU, RAM, disk)
# - Configure network (VLAN, tags, pools)
# - Start VMs (boot with DHCP)
# =============================================================================

- name: ADFR-1 - Deploy ADFR Lab VMs
  hosts: all
  gather_facts: false
  serial: 0

  vars:
    proxmox_operation: deploy

  tasks:
    - name: Display deployment plan
      debug:
        msg:
          - "========================================="
          - "  ADFR-1: Deploy ADFR Lab Infrastructure"
          - "========================================="
          - ""
          - "Deploying {{ ansible_play_hosts | length }} VMs:"
          - "  • D1 Forest: {{ groups['d1_forest'] | default([]) | length }} VMs"
          - "  • D2 Forest: {{ groups['d2_forest'] | default([]) | length }} VMs"
          - "  • ADFR Infrastructure: {{ groups['infrastructure'] | default([]) | length }} VMs"
          - "  • Recovery VMs: {{ groups['recovery_vms'] | default([]) | length }} VMs"
          - ""
          - "VMs will boot with DHCP"
          - "Run ADFR-2 next to configure static IPs"
      run_once: true
      delegate_to: localhost

    - name: Deploy VM (clone + configure + start)
      include_role:
        name: proxmox
        apply:
          delegate_to: localhost

    - name: Display deployment status
      debug:
        msg: "{{ inventory_hostname }} - {{ 'NEWLY DEPLOYED' if (vm_changed | default(false)) else 'ALREADY EXISTS' }}"

# =============================================================================
# Summary
# =============================================================================
- name: ADFR-1 Complete
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Display completion summary
      debug:
        msg:
          - ""
          - "========================================="
          - "  ADFR-1 Complete!"
          - "========================================="
          - ""
          - "✓ VMs deployed and started"
          - ""
          - "Next: Run ADFR-2 to configure static IPs and hostnames"