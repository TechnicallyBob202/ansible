---
# ==========================================
# AUTOMATED FOREST & DOMAIN BUILD FOR ALL DOMAINS
# ==========================================

- name: Build forests and domains
  hosts: all
  gather_facts: no
  vars:
    windows_password: "{{ lookup('env','WINDOWS_PASSWORD') }}"
    domains:
      - fqdn: "arbor.lab"
        netbios: "ARBOR"
        root_pdc: "arbor_forest_root_pdc"
        replicas: ["arbor_forest_root_replica"]
        admin_user: "Administrator"
      - fqdn: "alpine.lab"
        netbios: "ALPINE"
        root_pdc: "alpine_forest_root_pdc"
        replicas: ["alpine_forest_root_replica"]
        admin_user: "Administrator"
      - fqdn: "mauna.alpine.lab"
        netbios: "MAUNA"
        root_pdc: "mauna_child_pdc"
        replicas: ["mauna_child_replica"]
        admin_user: "ALPINE\\Administrator"
      - fqdn: "rainier.alpine.lab"
        netbios: "RAINIER"
        root_pdc: "rainier_child_pdc"
        replicas: ["rainier_child_replica"]
        admin_user: "ALPINE\\Administrator"

  tasks:

    - name: Process each domain
      include_tasks: 00-domain-build.yml
      loop: "{{ domains }}"
      loop_control:
        loop_var: domain
