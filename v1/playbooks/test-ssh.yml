---
- name: Test SSH using a specific key file (no passwords)
  hosts: "192.168.35.248"
  gather_facts: false
  vars:
    ansible_connection: ssh
    ansible_user: blyons
    ansible_python_interpreter: /usr/bin/python3

    # EDIT this to the real absolute path on the Semaphore runner
    ansible_ssh_private_key_file: "~/.ssh/ansible_key"

    # Force publickey-only so Ansible never tries password mode
    ansible_ssh_common_args: "-o PreferredAuthentications=publickey -o PasswordAuthentication=no -o StrictHostKeyChecking=no"

    # If your ansible-core is 2.19+, hard-disable password prompts in the ssh plugin
    ansible_ssh_password_mechanism: disable

    # Neutralize any leaked password vars from inventory (e.g., Windows defaults)
    ansible_password: ""
    ansible_ssh_password: ""

  tasks:
    - name: Ping over SSH
      ansible.builtin.ping:

    - name: Who am I
      ansible.builtin.command: whoami
      register: who
      changed_when: false

    - name: Show result
      ansible.builtin.debug:
        msg: "Connected to {{ inventory_hostname }} as {{ who.stdout }}"