# roles/semperis_adfr/tasks/stage_adfr_install.yml
---
- name: Create local Semperis directory
  ansible.windows.win_file:
    path: "{{ adfr_local_path }}"
    state: directory

- name: Copy ADFR files from SMB share
  ansible.windows.win_shell: |
    robocopy "{{ adfr_smb_source }}" "{{ adfr_local_path }}" /E /NFL /NDL /NJH /NJS /nc /ns /np

    # Robocopy exit codes 0-7 are success
    if ($LASTEXITCODE -ge 8) {
      exit 1
    }
    exit 0
  register: copy_result
  failed_when: copy_result.rc != 0

- name: Display staging results
  debug:
    msg: "ADFR files staged to {{ adfr_local_path }}"