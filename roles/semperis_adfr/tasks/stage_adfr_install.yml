---
# Stage ADFR installation files from SMB share to local directory

- name: Create local Semperis directory
  ansible.windows.win_file:
    path: "{{ adfr_local_path }}"
    state: directory
  register: folder_create

- name: Display folder creation result
  debug:
    msg:
      - "{{ inventory_hostname }} - Folder creation"
      - "  Path: {{ adfr_local_path }}"
      - "  Changed: {{ folder_create.changed }}"

- name: Verify folder exists
  ansible.windows.win_stat:
    path: "{{ adfr_local_path }}"
  register: folder_stat

- name: Display folder verification
  debug:
    msg:
      - "{{ inventory_hostname }} - Folder verification"
      - "  Exists: {{ folder_stat.stat.exists }}"
      - "  Path: {{ folder_stat.stat.path | default('N/A') }}"

- name: Fail if folder doesn't exist
  fail:
    msg: "Failed to create {{ adfr_local_path }}"
  when: not folder_stat.stat.exists