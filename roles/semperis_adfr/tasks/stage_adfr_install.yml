---
# Stage ADFR installation files from SMB share to local directory

- name: Create local Semperis directory
  ansible.windows.win_file:
    path: "{{ adfr_local_path }}"
    state: directory

- name: Copy ADFR files using robocopy
  ansible.windows.win_shell: |
    robocopy "{{ adfr_smb_source }}" "{{ adfr_local_path }}" /E /NFL /NDL /NJH /NJS /nc /ns /np
    if ($LASTEXITCODE -lt 8) { exit 0 } else { exit $LASTEXITCODE }
  register: adfr_copy_result
  changed_when: adfr_copy_result.rc == 0

- name: Display copy result
  debug:
    msg:
      - "{{ inventory_hostname }} - ADFR files copied"
      - "  Source: {{ adfr_smb_source }}"
      - "  Destination: {{ adfr_local_path }}"