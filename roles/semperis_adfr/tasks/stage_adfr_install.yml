---
# Stage ADFR installation files from SMB share to local directory

- name: Check current user
  ansible.windows.win_shell: |
    whoami
  register: current_user
  changed_when: false

- name: Display current user
  debug:
    var: current_user.stdout

- name: Create local Semperis directory
  ansible.windows.win_file:
    path: "{{ adfr_local_path }}"
    state: directory

- name: Copy using PowerShell Copy-Item
  ansible.windows.win_shell: |
    Copy-Item -Path "\\192.168.33.13\Semperis\ADFR\InstallationMedia\5.1\ADFR-5.1\*" -Destination "{{ adfr_local_path }}" -Recurse -Force
    Write-Host "Copy completed"
  register: adfr_copy_result
  async: 600
  poll: 10

- name: Display copy result
  debug:
    msg:
      - "{{ inventory_hostname }} - Copy completed"
      - "{{ adfr_copy_result.stdout }}"