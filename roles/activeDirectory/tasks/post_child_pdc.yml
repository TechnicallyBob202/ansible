---
# Always-run healing for child PDCs: ensure DNS = [self, alpine root PDC]

- name: Resolve alpine root PDC IP (once)
  set_fact:
    alpine_root_pdc_ip: "{{ hostvars[groups['alpine_forest_root_pdc'][0]].ansible_host }}"
  run_once: yes

- name: Set DNS for child PDCs (post)
  set_fact:
    windows_dns_servers: "{{ [ ansible_host, alpine_root_pdc_ip ] }}"
  when: >
    inventory_hostname in (groups['mauna_child_pdc'] | default([]))
    or
    inventory_hostname in (groups['rainier_child_pdc'] | default([]))

- name: Apply DNS (post)
  include_role:
    name: windows
    tasks_from: set_dns.yml
  when: windows_dns_servers is defined