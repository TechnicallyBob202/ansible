---
# Main task file for activeDirectory role
# Routes to specific task files based on operation

# =============================================================================
# Stage 03 Operations - DC Promotion and Forest Building
# =============================================================================

- name: Include domain status check tasks
  include_tasks: check_domain_status.yml
  when: ad_operation == 'check_domain_status'

- name: Include AD features installation tasks
  include_tasks: install_ad_features.yml
  when: ad_operation == 'install_ad_features'

- name: Include forest root promotion tasks
  include_tasks: promote_forest_root.yml
  when: ad_operation == 'promote_forest_root'

- name: Include replica DC promotion tasks
  include_tasks: promote_replica_dc.yml
  when: ad_operation == 'promote_replica_dc'

- name: Include child domain promotion tasks
  include_tasks: promote_child_domain.yml
  when: ad_operation == 'promote_child_domain'

- name: Include DC readiness check tasks
  include_tasks: wait_for_dc_ready.yml
  when: ad_operation == 'wait_for_dc_ready'

- name: Include replication verification tasks
  include_tasks: verify_replication.yml
  when: ad_operation == 'verify_replication'

- name: Include service account creation tasks
  include_tasks: create_service_accounts.yml
  when: ad_operation == 'create_service_accounts'

- name: Include FSMO role check tasks
  include_tasks: check_fsmo_roles.yml
  when: ad_operation == 'check_fsmo_roles'

# =============================================================================
# Stage 04 Operations - OU Structure and Domain Population
# =============================================================================

- name: Include OU structure deletion tasks
  include_tasks: delete_ou_structure.yml
  when: ad_operation == 'delete_ou_structure'

- name: Include OU structure creation tasks
  include_tasks: create_ou_structure.yml
  when: ad_operation == 'create_ou_structure'

- name: Include GPO creation tasks
  include_tasks: create_gpos.yml
  when: ad_operation == 'create_gpos'

- name: Include GPO linking tasks
  include_tasks: link_gpos.yml
  when: ad_operation == 'link_gpos'

- name: Include user creation tasks
  include_tasks: create_users.yml
  when: ad_operation == 'create_users'

- name: Include group creation tasks
  include_tasks: create_groups.yml
  when: ad_operation == 'create_groups'

- name: Include computer creation tasks
  include_tasks: create_computers.yml
  when: ad_operation == 'create_computers'

- name: Include test account creation tasks
  include_tasks: create_test_accounts.yml
  when: ad_operation == 'create_test_accounts'

- name: Include group membership assignment tasks
  include_tasks: assign_memberships.yml
  when: ad_operation == 'assign_memberships'

- name: Include security issue creation tasks
  include_tasks: create_security_issues.yml
  when: ad_operation == 'create_security_issues'

- name: Include disable objects tasks
  include_tasks: disable_objects.yml
  when: ad_operation == 'disable_objects'