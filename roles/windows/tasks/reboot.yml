---
# Reboot Windows and wait for it to come back

- name: Reboot Windows
  ansible.windows.win_reboot:
    reboot_timeout: "{{ windows_reboot_timeout }}"
    post_reboot_delay: "{{ windows_post_reboot_delay }}"
    msg: "Ansible-initiated reboot"
    pre_reboot_delay: 5
  register: reboot_result

- name: Wait for WinRM to be available
  wait_for:
    host: "{{ ansible_host }}"
    port: 5985
    timeout: "{{ windows_connection_timeout }}"
    delay: 10
  delegate_to: localhost

- name: Verify system is responsive
  ansible.windows.win_ping:
  register: ping_result
  retries: 3
  delay: 10
  until: ping_result is succeeded

- name: Display reboot result
  debug:
    msg: "{{ inventory_hostname }} - Rebooted successfully (uptime: {{ reboot_result.elapsed }}s)"