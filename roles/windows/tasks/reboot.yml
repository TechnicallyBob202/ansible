---
# Reboot Windows and wait for it to come back

- name: Reboot Windows
  ansible.windows.win_reboot:
    reboot_timeout: "{{ windows_reboot_timeout }}"
    post_reboot_delay: "{{ windows_post_reboot_delay }}"
    msg: "Ansible-initiated reboot"
    pre_reboot_delay: 5
  register: reboot_result

- name: Wait for system to be reachable
  wait_for_connection:
    connect_timeout: 30
    sleep: 30
    timeout: 1200

- name: Verify system is responsive
  ansible.windows.win_ping:
  register: ping_result
  retries: 30
  delay: 10
  until: ping_result is succeeded

- name: Display reboot result
  debug:
    msg: "{{ inventory_hostname }} - Rebooted successfully (uptime: {{ reboot_result.elapsed }}s)"