---
# Validate Linux network configuration

- name: Get IP address
  ansible.builtin.command: ip -4 addr show
  register: ip_info
  changed_when: false

- name: Get default gateway
  ansible.builtin.command: ip route show default
  register: route_info
  changed_when: false

- name: Get DNS configuration
  ansible.builtin.command: resolvectl status
  register: dns_info
  changed_when: false
  ignore_errors: true

- name: Fallback DNS check
  ansible.builtin.command: cat /etc/resolv.conf
  register: dns_fallback
  changed_when: false
  when: dns_info.failed | default(false)

- name: Get hostname
  ansible.builtin.command: hostname
  register: hostname_info
  changed_when: false

- name: Display validation results
  debug:
    msg:
      - "{{ inventory_hostname }} - Network Validation:"
      - "  IP Configuration:"
      - "{{ ip_info.stdout_lines | join('\n') }}"
      - "  Default Gateway:"
      - "{{ route_info.stdout }}"
      - "  DNS Servers:"
      - "{{ (dns_info.stdout_lines if not dns_info.failed else dns_fallback.stdout_lines) | join('\n') }}"
      - "  Hostname: {{ hostname_info.stdout }}"